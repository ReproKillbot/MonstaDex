<modal>
    <div class="container">

        <!-- The Modal -->
        <div class="modal fade" id="myModal">
            <div class="modal-dialog">
                <div class="modal-content">

                    <!-- Modal Header -->
                    <div class="modal-header">
                        <h4 class="modal-title text-center">Choose what monster you want</h4>
                        <button type="button" class="close" data-dismiss="modal">&times;</button>
                    </div>

                    <!-- Modal body -->
                    <div class="modal-body">
                        <div class="container">
                            <select name="mon_list" id="mon_list" onchange="{set_monster}">
                                <!-- Below you'll see more notes, but we are assigning this value
                                to the each's index so we can reference the list of monsters we have with this key
                                I also removed the ID of this - because you can't set a non-unique ID. An each statement
                                will replicate each option element with the same ID, no bueno. -->
                                <option each="{monster, index in monsters}" value="{index}">{monster.monsterName}</option>
                            </select>
                        </div>
                        <div id="image_preview">
                            <!-- Do as I say, not as I do! Haha. Please make this a style rule! -->
                            <img id="mon_pic" style="height: 50px; width: 50px;" src={chosen_monster.image}>
                        </div>
                    </div>
                    <!-- Modal footer -->
                    <div class="modal-footer">
                        <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
                        <button type="button" class="btn btn-primary" onclick="{create_binding}">Save changes</button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        var self = this
        self.monsters = {}
        self.player = {}
        // We always want to set an object ahead of time - don't just call self.chosen_monster in a function, it needs
        // to be persistent. It may have worked without it but it's bad practice to do so
        self.chosen_monster = {}
        self.on('mount', function(){
            // This is not a bad way to do this - I think this is fine just as it is.
            CLIENT.events.on("player-found", self.save_player)
            self.base_mon()
        })

        self.create_binding = function(){
            CLIENT.api.create_binding({monster:self.chosen_monster})
        }

        self.set_monster = function(){
            // this runs everytime the dropdown changes, as you can see above
            // I got rid of that very gross jquery function because it's unnecessary - if it is hard to do and icky we should find a simpler way
            // Above, I set the value for each option element as the index of the each loop
            // That way, we can grab the value from the option and pass it in as an index to our list of monsters (Like below)
            self.chosen_monster = self.monsters[$('#mon_list option:selected').val()]
        }

        self.base_mon = function(){
            CLIENT.api.base_mon()
                .done(function(monsters){
                    self.monsters = monsters
                    // Once we set the monsters, we need to set the chosen_monster to equal the first in the list [0] (Slagpole)
                    // In set_monster we are going to use the value of the dropdown, which we set as the index of self.monsters
                    self.chosen_monster = self.monsters[0]
                })
        }

        self.save_player = function(player){
            self.player = player
        }
    </script>
</modal>